<?php
///==========================================================================================
/// NOTICE OF LICENSE & DISCLAIMER
///
/// This source file is subject to the Software License Agreement that is bundled with this 
/// package in the file license.txt, or you can get it here
/// http://addons-modules.com/en/content/3-terms-and-conditions-of-use
///
///	We donot recomend to make any changes(customizations) to the PHP files, othrwise you are
///	not able to upagrde your modules.
///
/// If you do need to make changes to source code files, please consult us first.
/// http://addons-modules.com/en/contact-us
///
///	Vist our support forum if you require technical support
/// http://addons-modules.com/modules/agileforumphpbb/agileforum.php
///
/// @copyright  2009-2012 Addons-Modules.com
/// 
///==========================================================================================

class AgileInstall extends ObjectModel  {      public static function sql_install($sqlfile)      {    if (!file_exists($sqlfile))     return (false);    else if (!$sql = file_get_contents($sqlfile))     return (false);    $sql = str_replace('PREFIX_', _DB_PREFIX_, $sql);    $sql = preg_split("/;\s*[\r\n]+/",$sql);        foreach ($sql as $query)    {        if(strlen($query)<=3)continue;     if (!Db::getInstance()->Execute(trim($query)))      return (false);       }          return true;              }            public static function create_tab($tabName, $tabClassName, $parentTabClassName,$modulename)      {                $tid = Tab::getIdFromClassName($tabClassName);          if(!isset($tid) OR $tid==0)          {              $parentid = Tab::getIdFromClassName($parentTabClassName);                          if(!$parentid)                  $parentid = Tab::getIdFromClassName( str_replace('Admin','Agile',$parentTabClassName));                $tab = new Tab();              $tab->id_parent = $parentid;              $tab->module = $modulename;        $languages = Language::getLanguages();        foreach ($languages AS $language)        {                  $tab->{'name'}[intval($language['id_lang'])] = $tabName;              }              $tab->class_name = $tabClassName;              if(!$tab->add())return false;           }          return true;      }            public static function delete_tab($tabClassName)      {          $tid = Tab::getIdFromClassName($tabClassName);          if(isset($tid) AND $tid>0)          {              $tab = new Tab($tid);              $tab->delete();          }      }            public static function create_hook($hookname)      {       $id_hook = Hook::get($hookname);       if(!$id_hook)       {           $hook = new Hook();           $hook->name = $hookname;           $hook->save();       }      }            public static function update_access($id_profile, $tabClassName, $view, $edit, $add, $delete)      {          $id_tab = intval(Tab::getIdFromClassName($tabClassName));          $sql = 'UPDATE `'._DB_PREFIX_.'access` a              SET a.`view`=' . intval($view) .', a.`edit`=' . intval($edit). ', a.`add`=' . intval($add) . ', a.`delete`=' . intval($delete) . '               WHERE a.`id_tab` = ' . intval($id_tab) . '                  AND  a.`id_profile` =' . intval($id_profile);                                         Db::getInstance()->ExecuteS($sql);      }            public static function add_field_ifnotexists($table,$field,$datatype,$default)      {          if(empty($table) OR empty($field) OR empty($datatype))return;                    if(!self::column_exists($table,$field))           Db::getInstance()->Execute('ALTER TABLE ' . _DB_PREFIX_ . '' . $table . ' ADD ' . $field . ' ' . $datatype . ' NULL DEFAULT ' . $default . ';');      }            public static function show_agile_links()      {          $link_guide = 'http://addons-modules.com/fr/content/category/2-user-s-guide';          $link_forum = 'http://addons-modules.com/modules/agileforumphpbb/agileforum.php';          return '          <div style="border:dotted 1px blue;padding:10px">              <b>' . Tools::displayError('Got questions or need help?'). '</b><br />              ' . Tools::displayError('Please try to find your answers at '). '<a href="' . $link_guide .'" target="help" style="text-decoration:underline;color:Blue;">' . Tools::displayError('User\'s Guide'). '</a>' . Tools::displayError(' pages for the specific product/module you are using.') . '&nbsp;              ' . Tools::displayError('If you are not able to find an answer there, please post your questions to the specific thread of the product at '). '<a href="' . $link_forum . '"  target="help" style="text-decoration:underline;color:Blue;">Agile Support Forum</a>, ' . Tools::displayError('you be answered quickly.') . '          </div>          <br />          ';      }             private static function column_exists($table,$column)     {         $sql = "show columns from " . _DB_PREFIX_ . $table;        $columns = Db::getInstance()->ExecuteS($sql);         foreach($columns AS $c)         {             if(strtolower($c['Field']) == strtolower($column))return true;         }                  return false;     }       }  